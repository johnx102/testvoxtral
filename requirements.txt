# =============================================================================
# REQUIREMENTS.TXT - Versions testées et compatibles entre elles
# Dernière mise à jour: 2026-01-13
# =============================================================================

# -----------------------------------------------------------------------------
# PYTORCH 2.7.1 - Support tous GPUs (RTX 6000 Ada inclus)
# -----------------------------------------------------------------------------
--extra-index-url https://download.pytorch.org/whl/cu128
torch==2.7.1
torchaudio==2.7.1
torchvision==0.22.1

# -----------------------------------------------------------------------------
# TRANSFORMERS + ACCELERATE (versions compatibles entre elles)
# Voxtral support ajouté en transformers 4.54.0
# -----------------------------------------------------------------------------
transformers>=4.54.0,<4.58.0
accelerate>=1.0.0,<2.0.0
huggingface_hub>=0.24.0,<1.0

# -----------------------------------------------------------------------------
# PYANNOTE - Speaker diarization (3.3.2 = stable, pas de conflits)
# Le fix weights_only est appliqué via patch dans Dockerfile
# -----------------------------------------------------------------------------
pyannote.audio==3.3.2
lightning>=2.0.1,<3.0.0

# -----------------------------------------------------------------------------
# MISTRAL / VOXTRAL - Audio transcription
# mistral_common[audio] nécessite Python >= 3.10
# -----------------------------------------------------------------------------
mistral_common[audio]>=1.8.1,<2.0.0
sentencepiece>=0.2.0

# -----------------------------------------------------------------------------
# AUDIO PROCESSING
# Note: librosa est installé automatiquement par pyannote avec versions compatibles
# -----------------------------------------------------------------------------
soundfile>=0.12.1
pydub>=0.25.1

# -----------------------------------------------------------------------------
# NUMPY/SCIPY - Laisser pyannote gérer les versions compatibles
# -----------------------------------------------------------------------------
numpy<2.0.0

# -----------------------------------------------------------------------------
# AUTRES DÉPENDANCES
# -----------------------------------------------------------------------------
requests>=2.32.0
safetensors>=0.4.0
einops>=0.6.0

# -----------------------------------------------------------------------------
# RUNPOD
# -----------------------------------------------------------------------------
runpod>=1.6.0,<2.0.0

# -----------------------------------------------------------------------------
# OPTIONNEL - WhisperX (décommenter si nécessaire)
# Alternative à Voxtral pour éviter les bugs de répétition
# -----------------------------------------------------------------------------
# git+https://github.com/m-bain/whisperX.git
